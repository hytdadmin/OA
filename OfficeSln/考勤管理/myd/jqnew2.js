if(typeof(Array.prototype.push)!="function"){Array.prototype.push=function(){for(var a=0;a<arguments.length;a++){this[this.length]=arguments[a];}return this.length;};}String.prototype.format=function(){var a=arguments;return this.replace(/\{(\d+)\}/g,function(b,c){return a[c];});};var hrefSave=document.getElementById("hrefSave");var cur_page=0;var jumpPages;var pageHolder=new Array();var trapHolder=new Array();var totalQ=0;var completeLoaded=false;var MaxTopic=0;if(displayPrevPage=="none"&&(hasJoin=="1"||isSuper)){displayPrevPage="";}var curdiv=null;var curfilediv=null;var isUploadingFile=false;var hasZhenBiePage=false;var progressArray=new Object();var questionsObject=new Object();var joinedTopic=0;var randomparm="";var hasTouPiao=false;var useSelfTopic=false;var isChrome=window.chrome;var ZheZhaoControl=null;function forbidBackSpace(f){var c=f||window.event;var d=c.target||c.srcElement;var b=d.type||d.getAttribute("type");var a=c.keyCode==8&&b!="password"&&b!="text"&&b!="textarea";if(a){return false;}}document.onkeydown=forbidBackSpace;var needCheckLeave=true;if(allowSaveJoin&&isRunning=="true"&&guid){window.onunload=function(){if(needCheckLeave){if(confirm("您要保存填写的答卷吗？")){submit(2);alert("答卷保存成功！");}}};}$=function(a){return document.getElementById(a);};$$=function(a,b){if(b){return b.getElementsByTagName(a);}else{return document.getElementsByTagName(a);}};function getTop(b){var a=b.offsetLeft;var c=b.offsetTop;while(b=b.offsetParent){a+=b.offsetLeft;c+=b.offsetTop;}return{x:a,y:c};}function addEventSimple(c,a,b){if(c.addEventListener){c.addEventListener(a,b,false);}else{if(c.attachEvent){c.attachEvent("on"+a,b);}}}function removeEventSimple(c,a,b){if(c.removeEventListener){c.removeEventListener(a,b,false);}else{if(c.detachEvent){c.detachEvent("on"+a,b);}}}function Request(d){var b=window.document.location.href;var f=b.indexOf("?");var e=b.substr(f+1);var c=e.split("&");for(var a=0;a<c.length;a++){var g=c[a].split("=");if(g[0].toUpperCase()==d.toUpperCase()){return g[1];}}return"";}var txtCurCity=null;function openCityBox(e,d,c,f){txtCurCity=e;if(e.getAttribute("lastdata")=="1"){txtCurCity.lastData=1;}ZheZhaoControl=txtCurCity;f=f||"";var a=e.getAttribute("province");var b="";if(a){b="&pv="+encodeURIComponent(a);}if(d==3){PDF_launch("/wjx/design/setcitycounty.aspx?activityid="+activityId+"&ct="+d+b+"&pos="+f,470,220);}else{if(d==4){ZheZhaoControl=null;PDF_launch("/wjx/design/school.aspx?activityid="+activityId+b,700,340);}else{PDF_launch("/wjx/design/setcity.aspx?activityid="+activityId+"&ct="+d+"&pos="+f,470,220);}}}function setCityBox(a){txtCurCity.value=a;}var submit_tip=$("submit_tip");var submit_div=$("submit_div");function trim(a){return a.replace(/(^\s*)|(\s*$)/g,"");}function isInt(a){var b=/^-?[0-9]+$/;return b.test(a);}var spChars=["$","}","^","|","<"];var spToChars=["ξ","｝","ˆ","¦","&lt;"];function replace_specialChar(c){for(var a=0;a<spChars.length;a++){var b=new RegExp("(\\"+spChars[a]+")","g");c=c.replace(b,spToChars[a]);}return c;}function isRadioImage(a){if(!a||a=="0"||a=="1"||a=="101"){return false;}else{return true;}}function isRadioRate(a){return a!=""&&a!="0"&&a!="1"&&a!="-1";}var submit_table=$("submit_table");var pre_page=$("btnPre");var next_page=$("btnNext");var submit_button=$("submit_button");var imgCode=$("imgCode");var submit_text=$("yucinput");var tCode=$(tdCode);var divMinTime=$("divMinTime");var spanMinTime=$("spanMinTime");var divMaxTime=$("divMaxTime");var spanMaxTime=$("spanMaxTime");var maxCounter=0;var maxTimer=null;function changeHeight(d){var e=parseInt(d.style.height);if(!e){return;}var c=18;var b=100;var a=d.scrollHeight;a=a>c?a:c;a=a>b?b:a;if(a-e>=10){d.style.height=a+"px";}}function fcInputboxFocus(){}function lengthChange(c){var a=c.value.length;var b=c.size;if(a>=b&&b<=80){c.size=a+2;}else{if(b>80){}}}function fcInputboxBlur(){if(!this.value){this.value=defaultOtherText;this.style.color="#999999";}else{this.style.color="#000000";if(langVer!=0){return;}if(this.tagName=="select"){return;}var e=this.parent;var c=e.itemInputs;var f=this.value.split(/(,|，)/ig);for(var d=0;d<c.length;d++){var b=c[d].nextSibling;if(b&&b.nodeType==3){b=b.nextSibling;}if(!b){return;}for(var a=0;a<f.length;a++){if(trim(f[a].toLowerCase())==trim(b.innerHTML.toLowerCase())){alert("提示：您输入的“"+f[a]+"”已经包含在题目选项当中");c[d].checked=true;b.style.color="red";}}}}}function isTextBoxEmpty(a){a=trim(a);if(a==""||a==defaultOtherText){return true;}return false;}function refresh_validate(){if(imgCode&&tCode.style.display!="none"&&imgCode.style.display!="none"){imgCode.src="/AntiSpamImageGen.aspx?q="+activityId+"&t="+(new Date()).valueOf();}if(window.Recaptcha){Recaptcha.reload();}}function enter_clicksub(a){a=a||window.event;if(a&&a.keyCode==13){submit(1);}}var relationHT=new Array();var relationQs=new Object();var relationNotDisplayQ=new Object();var nextPageAlertText="";var hasMaxtime=false;var imgVerify=null;Init();function Init(){if(cur_page==0&&!displayPrevPage&&pre_page){pre_page.style.display="";pre_page.disabled=true;}pageHolder=$$("fieldset",survey);for(var ak=0;ak<pageHolder.length;ak++){var ad=pageHolder[ak].getAttribute("skip")=="true";if(ad){pageHolder[ak].skipPage=true;}}submit_button.onmouseover=function(){this.className="submitbutton submitbutton_hover";if(isPub&&$("spanTest").style.visibility!="visible"){$("spanTest").style.visibility="visible";$("submittest_button").onmouseover=function(){show_status_tip("您是发布者，可以进行试填问卷，试填的答卷不会参与结果统计！",5000);$("submittest_button").onmouseover=null;};}};submit_button.onclick=function(){if(checkDisalbed()){return;}submit(1);};if(isPub){$("submittest_button").onclick=function(){if(!isTest&&confirm("试填后的答卷不会参与结果统计，确定试填吗？")){submit(5);}else{if(isTest){submit(5);}}};if(isTest){submit_button.style.display="none";}}if(hasJoin=="3"){submit_button.onclick=function(){if(checkDisalbed()){return;}if(window.confirm("确定编辑此答卷吗？")){submit(6);}};}if(totalPage==1&&isRunning=="true"&&hasJoin!="1"){submit_table.style.display="";}else{if(isRunning!="true"){var t=$("spanNotSubmit");if(t&&trim(t.innerHTML)!=""){if(totalPage==1&&hasJoin!="1"){submit_table.style.display="";}nextPageAlertText=t.innerHTML.replace(/<[^>]*>/g,"");submit_button.onclick=function(){if(checkDisalbed()){return;}alert(nextPageAlertText);t.scrollIntoView();};}else{submit_table.style.display="none";}}else{submit_table.style.display="none";}}if(pre_page){pre_page.onclick=show_pre_page;}if(next_page){next_page.onclick=show_next_page;}if(tCode&&tCode.style.display!="none"&&isRunning=="true"){submit_text.value=validate_info_submit_title3;addEventSimple(submit_text,"blur",function(){if(submit_text.value==""){submit_text.value=validate_info_submit_title3;}});addEventSimple(submit_text,"focus",function(){if(submit_text.value==validate_info_submit_title3){submit_text.value="";}});imgCode.style.display="none";if(langVer!=0){imgCode.alt="";}addEventSimple(submit_text,"click",function(){if(!needAvoidCrack&&imgCode.style.display=="none"){imgCode.style.display="";imgCode.onclick=refresh_validate;imgCode.onclick();imgCode.title=validate_info_submit_title1;}else{if(needAvoidCrack&&!imgVerify){var q=$("divCaptcha");q.style.display="";imgVerify=q.getElementsByTagName("img")[0];imgVerify.style.cursor="pointer";imgVerify.onclick=function(){var az=new Date();var aw=az.getTime()+(az.getTimezoneOffset()*60000);var ax=window.location.host||"www.sojump.com";var ay="http://"+ax+"/BotDetectCaptcha.ashx?get=image&c="+this.captchaId+"&t="+this.instanceId+"&d="+aw;this.src=ay;};var i=imgVerify.getAttribute("captchaid");var k=imgVerify.getAttribute("instanceid");imgVerify.captchaId=i;imgVerify.instanceId=k;imgVerify.onclick();}}});}for(var ai=0;ai<pageHolder.length;ai++){var m=$$("div",pageHolder[ai]);if(hasJoin){pageHolder[ai].style.display="";}var p=new Array();var af=0;for(var ak=0;ak<m.length;ak++){var c=m[ak].className.toLowerCase();if(c=="div_question"){var h=m[ak].getAttribute("istrap")=="1";m[ak].onclick=divQuestionClick;if(h){trapHolder.push(m[ak]);initItem(m[ak]);m[ak].pageIndex=ai+1;m[ak].isTrap=true;}else{m[ak].indexInPage=af;p[af]=m[ak];p[af].pageIndex=ai+1;af++;totalQ++;}}}pageHolder[ai].questions=p;}set_data_fromServer(qstr);var O=new Array();for(var u=0;u<pageHolder.length;u++){var am=pageHolder[u].questions;for(var ak=0;ak<am.length;ak++){var M=am[ak].dataNode;var av=M._type;var E=am[ak].getAttribute("relation");if(E&&E!="0"){var S=E.split(",");var L=S[0];var d=S[1].split(";");for(var R=0;R<d.length;R++){var s=L+","+d[R];if(!relationHT[s]){relationHT[s]=new Array();}relationHT[s].push(am[ak]);}if(!relationQs[L]){relationQs[L]=new Array();}relationQs[L].push(am[ak]);relationNotDisplayQ[M._topic]="1";}else{if(E=="0"){relationNotDisplayQ[M._topic]="1";}}if(av!="page"&&av!="cut"){questionsObject[M._topic]=am[ak];}if(av=="radio"||av=="check"){if(av=="radio"&&isRadioImage(M._mode)){initLikertItem(am[ak]);}else{initItem(am[ak]);}if((av=="radio"||av=="check")&&!M.isRate){var Z=$$("img",am[ak]);for(var aj=0;aj<Z.length;aj++){Z[aj].onclick=function(){var i=this.getAttribute("rel");if(i){var q=$(i);q.click();var k=q.parent.parent||q.parent;this.style.border=q.checked?"solid 2px #ff9900":"solid 2px #eeeeee";if(q.type=="radio"){if(k&&k.prevImage&&k.prevImage!=this){k.prevImage.style.border="";}k.prevImage=this;}}};}}}if(av=="fileupload"){var o=$$("iframe",am[ak]);if(o&&o[0]){am[ak].uploadFrame=o[0];am[ak].uploadFrame.allowTransparency=true;var A=document.frames?document.frames[o[0].id]:document.getElementById(o[0].id).contentWindow;A.curdiv=am[ak];A._ext=M._ext;}var m=$$("div",am[ak]);for(var aj=0;aj<m.length;aj++){if(m[aj].className.toLowerCase()=="uploadmsg"){am[ak].uploadmsg=m[aj];m[aj].style.color="red";break;}}am[ak].uploadFinish=function(i,q){this.uploadmsg.innerHTML=i;this.fileName=q;isUploadingFile=false;this.uploadFrame.style.display="";var k=document.frames?document.frames[this.uploadFrame.id]:document.getElementById(this.uploadFrame.id).contentWindow;k.curdiv=this;k._ext=this.dataNode._ext;jump(this,this.uploadFrame);};}if(av=="matrix"){var n=M._mode;if(M._hasjump){if(n&&n-100<0){initLikertItem(am[ak]);}else{initItem(am[ak]);}}var g=am[ak].getAttribute("DaoZhi");var ar=null;if(!g){ar=$$("tr",am[ak]);}else{var Y=$$("tr",am[ak]);ar=new Array();var x=Y[0].cells.length-1;for(var C=0;C<x;C++){ar[C]=Y[0].cells[C+1];ar[C].itemInputs=new Array();}for(var C=0;C<x;C++){for(var a=0;a<Y.length;a++){var N=Y[a].cells[C+1];N.parent=ar[C];N.onclick=function(){if(curMatrixItem!=this.parent){var i=this.parent.itemInputs;if(i){for(var k=0;k<i.length;k++){i[k].parentNode.style.background="#edfafe";}}if(curMatrixItem&&curMatrixItem.daoZhi){i=curMatrixItem.itemInputs;for(var k=0;k<i.length;k++){i[k].parentNode.style.background="";}}divMatrixItemClick.call(this.parent);}};ar[C].parent=am[ak];ar[C].daoZhi=true;var al=N.getElementsByTagName("input")[0];if(al){ar[C].itemInputs.push(al);}}}}if(!g){for(var aj=0;aj<ar.length;aj++){if(n!="303"){if(n&&n-100<0){initLikertItem(ar[aj]);}else{if(!g){initItem(ar[aj]);}}}else{var ae=$$("select",ar[aj]);if(ae.length>0){ar[aj].itemSels=ae;}if(M._hasjump){for(var an=0;an<ae.length;an++){ae[an].parent=ar[aj];ae[an].onchange=function(){var ay=this.parent.parent;var ax=ay.itemTrs;var aw=false;for(var k=0;k<ax.length;k++){var q=ax[k].itemSels;if(!q){continue;}for(var i=0;i<q.length;i++){if(q[i].value){aw=true;break;}}if(aw){break;}}jumpAny(aw,ay);};}}}ar[aj].parent=am[ak];ar[aj].onclick=divMatrixItemClick;}}if(n=="301"||n=="102"){var z=am[ak].getAttribute("minvalue");var G=am[ak].getAttribute("maxvalue");am[ak].dataNode._minvalue=z;am[ak].dataNode._maxvalue=G;}if(ar.length>0){am[ak].itemTrs=ar;}}if(av=="sum"){initItem(am[ak]);var ar=$$("tr",am[ak]);var y=new Array();for(var aj=0;aj<ar.length;aj++){var X=$$("input",ar[aj]);if(X.length>0){ar[aj].parent=am[ak];y.push(ar[aj]);}}var v=am[ak].itemInputs.length;var r=am[ak].itemInputs;for(var aj=0;aj<v;aj++){r[aj].onblur=function(){txtChange(this);};}if(y.length>0){am[ak].itemTrs=y;}var Q=am[ak].getAttribute("rel");am[ak].relSum=$(Q);}if(av=="check"&&M.isSort){var au=$$("a",am[ak]);for(aj=0;aj<au.length;aj++){au[aj].onclick=itemSortClick;}}if(av=="question"){var ac=$$("textarea",am[ak]);if(ac.length>0){ac[0].onkeyup=function(){txtChange(this);};if(!ac[0].onclick){ac[0].onclick=ac[0].onkeyup;}ac[0].onblur=ac[0].onchange=function(){txtChange(this,1);};ac[0].parent=am[ak];am[ak].itemTextarea=ac[0];}}else{if(av=="gapfill"){var ac=$$("input",am[ak]);for(var I=0;I<ac.length;I++){ac[I].onkeyup=function(){txtChange(this);};if(!ac[I].onclick){ac[I].onclick=ac[I].onkeyup;}ac[I].onblur=ac[I].onchange=function(){txtChange(this,1);};ac[I].parent=am[ak];}am[ak].gapFills=ac;}}if(av=="radio_down"||(av=="check"&&M._mode)){var P=$$("select",am[ak]);if(P.length>0){P[0].onchange=itemClick;P[0].parent=am[ak];am[ak].itemSel=P[0];}}var ap=null;if(am[ak].dataNode._hasjump){ap=$$("label",am[ak]);for(var aa=0;aa<ap.length;aa++){if(ap[aa].id.indexOf("divJump")>-1){am[ak].jumpInfo=ap[aa];}}}var ah=$$("div",am[ak]);var V=0;var U=null;for(aj=0;aj<ah.length;aj++){if((av=="radio"||av=="check")&&!M.isRate){var W=ah[aj].getAttribute("rel");if(W){var l=ah[aj].getElementsByTagName("a");if(l.length==0){ah[aj].onclick=function(){var k=this.getAttribute("rel");var i=$(k);i.click();};}}}if(ah[aj].className.toLowerCase()=="div_title_question"){am[ak].divTitle=ah[aj];}else{if(ah[aj].className.toLowerCase()=="slider"){if(av=="matrix"||av=="sum"){U=ah[aj].parentNode.parentNode;V++;}else{if(av=="slider"){U=am[ak];}}U.divSlider=ah[aj];ah[aj].parent=U;var z=ah[aj].getAttribute("minvalue");var G=ah[aj].getAttribute("maxvalue");am[ak].dataNode._minvalue=z;am[ak].dataNode._maxvalue=G;var ag;if(av=="sum"){ag=U.getElementsByTagName("input")[0];}else{var at=ah[aj].getAttribute("rel");ag=$(at);}var aq=new neverModules.modules.slider({targetId:ah[aj].id,sliderCss:"imageSlider1",barCss:"imageBar1",min:parseInt(z),max:parseInt(G),sliderValue:ag,hints:slider_hint,change:itemClick});aq.create();U.sliderImage=aq;var H=ah[aj].getAttribute("defvalue");if(H&&isInt(H)){aq.setValue(parseInt(H));U.divSlider.value=parseInt(H);if(av=="sum"){if(hasJoin&&H){if(am[ak].sumLeft==undefined){am[ak].sumLeft=M._total-parseInt(H);}else{am[ak].sumLeft=am[ak].sumLeft-parseInt(H);}}else{am[ak].sumLeft=0;}}}if(hasJoin=="1"){aq._slider.onclick=function(){};aq._initMoveSlider=function(){};}}}}if(av=="matrix"){var D=new Array();var ar=am[ak].itemTrs;for(var aj=0;aj<ar.length;aj++){var F=ar[aj].itemInputs||ar[aj].itemLis||ar[aj].divSlider||ar[aj].itemSels;if(F){D.push(ar[aj]);}}if(D.length>0){am[ak].itemTrs=D;}}if(M&&M._hasjump){cur_page=u;if(hasJoin){jumpJoin(am[ak],u);}else{clearAllOption(am[ak]);}cur_page=0;}if(M._referedTopics){O.push(am[ak]);}if(hasJoin&&window.cancelInputClick){cancelInputClick(am[ak]);}}if(u>0&&hasJoin){pageHolder[u].style.display="none";}}completeLoaded=true;if(window.cepingCandidate){var e=cepingCandidate.split(",");var ab=new Object();for(var w=0;w<e.length;w++){ab[e[w]]="1";}var am=pageHolder[0].questions[0];if(am.itemInputs){for(var ak=0;ak<am.itemInputs.length;ak++){var T=am.itemInputs[ak].parentNode;var B=T.getElementsByTagName("label")[0];if(!B){continue;}var ao=trim(B.innerHTML);if(ab[ao]){am.itemInputs[ak].checked=true;}}}am.style.display="none";am.isCepingQ="1";}for(var ak=0;ak<O.length;ak++){var af=O[ak];createItem(af);}for(var u=0;u<pageHolder.length;u++){var am=pageHolder[u].questions;for(var ak=0;ak<am.length;ak++){var M=am[ak].dataNode;var K=M._topic;if(relationQs[K]){if(hasJoin){relationJoin(am[ak]);}else{clearAllOption(am[ak]);}}var b=am[ak].getAttribute("qingjing");if(b){var f=am[ak].getElementsByTagName("input")[0];f.checked=true;displayRelationRaidoCheck(am[ak],M);}}}if(lastSavePage>0&&lastSavePage<totalPage){pageHolder[0].style.display="none";cur_page=lastSavePage-1;show_next_page(true);}if(lastSaveQ>=1){var J=$("div"+lastSaveQ);if(J){J.scrollIntoView();J.onclick();joinedTopic=lastSaveQ;for(var ak=1;ak<=lastSaveQ;ak++){progressArray[ak+""]=true;}showProgressBar();}}if(totalQ==0){submit_table.style.display="none";}processMinMax();showProgressBar();}var prevPostion;var resizedMax;function processMinMax(){if(maxTimer){clearInterval(maxTimer);}if(isRunning=="true"){var c=pageHolder[cur_page]._maxtime;if(c){var e=c>10?10:1;maxCounter=c;divMaxTime.style.position="absolute";addEventSimple(window,"scroll",mmMaxTime);addEventSimple(window,"resize",resizeMaxTime);mmMaxTime();hasMaxtime=true;divMaxTime.style.display="";spanMaxTime.innerHTML=c;maxTimer=setInterval(function(){maxCounter--;spanMaxTime.innerHTML=maxCounter;if(maxCounter<=0){clearInterval(maxTimer);divMaxTime.style.display="none";pageHolder[cur_page].hasExceedTime=true;if(cur_page<totalPage-1){show_next_page();}else{if(tCode.style.display=="none"){submit(1);}}}},1000);}var b=pageHolder[cur_page]._mintime;var d=!IsSampleService||(IsSampleService&&promoteSource=="t")||window.pubNeedApply;if(!d){b=0;}if(b){if(pageHolder[cur_page]._istimer){var a=b;next_page.style.display="none";pre_page.style.display="none";var f=setInterval(function(){a--;if(a<=0){clearInterval(f);if(cur_page<totalPage-1){show_next_page();}else{if(tCode.style.display=="none"){submit(1);}}}},1000);}else{if(!isSuper){if(next_page){next_page.disabled=true;}submit_button.disabled=true;}divMinTime.style.display="";addEventSimple(window,"resize",resizeMinTime);resizeMinTime();spanMinTime.innerHTML=b;var a=b;var f=setInterval(function(){a--;spanMinTime.innerHTML=a;if(a<=0){clearInterval(f);if(next_page){next_page.disabled=false;}submit_button.disabled=false;divMinTime.style.display="none";}},1000);}}}}function resizeMaxTime(){resizedMax=true;mmMaxTime();}function mmMaxTime(){var b=document.documentElement.scrollTop||document.body.scrollTop;var a=getTop(survey);var d=a.x-54;var c=b+a.y-40;if(d<=0){d=qwidth-10;c=b+a.y+10;}divMaxTime.style.top=c+"px";divMaxTime.style.left=d+"px";}function resizeMinTime(){var b;b=submit_table.style.display=="none"?next_page:submit_table.lastChild;var a=getTop(b);divMinTime.style.left=(a.x+b.offsetWidth+10)+"px";divMinTime.style.top=a.y+8+"px";}function initItem(d){var a=$$("input",d);if(a.length==0){a=$$("textarea",d);}for(var c=0;c<a.length;c++){a[c].parent=d;if(!a[c].onclick){a[c].onclick=itemClick;}if(a[c].tagName=="TEXTAREA"){a[c].onchange=a[c].onblur=itemClick;}var i=a[c].getAttribute("rel");if(i){var h=null;if(i=="psibling"){h=a[c].previousSibling;if(h.nodeType!=1){h=h.previousSibling;}a[c].onclick=itemClick;}else{h=$(i);}h.itemText=a[c];a[c].choiceRel=h;if(d.dataNode&&!d.dataNode.isSort){a[c].onblur=fcInputboxBlur;}if(d.dataNode&&d.dataNode._referedTopics){a[c].onchange=itemClick;}if(!a[c].value){a[c].value=defaultOtherText;}a[c].style.color="#999999";var f=a[c].getAttribute("req");if(f=="true"){h.req=true;}else{h.req=false;}}if(d.dataNode&&(d.dataNode._type=="radio"||d.dataNode._type=="check")&&!d.dataNode.isSort&&(!d.dataNode.isRate||d.dataNode._mode=="101")){var e=a[c].nextSibling;if(a[c].choiceRel){var h=a[c].previousSibling;if(h){if(h.nodeType!=1){h=h.previousSibling;}h.style.display="inline-block";a[c].style.position="static";}}else{if(e!=null){var g=a[c].parentNode;g.onmouseover=function(){this.style.background="#efefef";};g.onmouseout=function(){this.style.background="";};}}}else{if(d.tagName=="TR"&&(a[c].type=="radio"||a[c].type=="checkbox")){var b=a[c].parentNode;b.style.cursor="pointer";b.onclick=function(m){var k=this.getElementsByTagName("input");var l=k[0];if(l.type=="checkbox"){if(k.length==1){l.checked=!l.checked;l.onclick();}}else{l.checked=true;l.onclick();}};b.onmouseover=function(){this.style.background="#efefef";};b.onmouseout=function(){this.style.background="";};}}}if(a.length>0){d.itemInputs=a;}}function initLikertItem(b){var e=$$("li",b);var a=new Array();var f=false;var d;for(j=0;j<e.length;j++){var c=e[j].className.toLowerCase();if(e[j].className&&(c.indexOf("off")>-1||c.indexOf("on")>-1)){e[j].onclick=itemLiClick;e[j].onmouseover=itemMouseOver;e[j].onmouseout=itemMouseOut;e[j].parent=b;a.push(e[j]);if(c.indexOf("on")>-1){d=e[j];}else{if(c.indexOf("off")>-1&&d){d.parent.holder=d.value;}}}}if(e.length>0){if(d){d.parent.holder=d.value;}b.itemLis=a;}}function createItem(k){var s=k.dataNode;var r=s._referedTopics.split(",");var t=new Array();for(var i=0;i<k.itemInputs.length;i++){if(k.itemInputs[i].checked){t.push(k.itemInputs[i]);}}for(var i=0;i<r.length;i++){var l=r[i];var n=questionsObject[l];if(!n){continue;}var a=false;var c=document.getElementById("divRef"+l);if(!c){continue;}var f=0;switch(n.dataNode._type){case"matrix":case"sum":var d=n.itemTrs[0].itemInputs||n.itemTrs[0].itemLis||n.itemTrs[0].divSlider||n.itemTrs[0].itemSels;if(!d){f=1;}for(var p=0;p<k.itemInputs.length;p++){var e=k.itemInputs[p];if(!e.value||e.type!="checkbox"){continue;}var o=parseInt(e.value)-1+f;if(!n.itemTrs[o]){break;}n.itemTrs[o].style.display=e.checked?"":"none";if(e.checked){a=true;if(e.itemText){var u=e.itemText.value;var h=n.itemTrs[o].getElementsByTagName("th")[0];if(h){if(!h.span){h.span=document.createElement("span");h.appendChild(h.span);}if(u&&u!=defaultOtherText){h.span.innerHTML="[<span style='color:red;'>"+u+"</span>]";}else{h.span.innerHTML="";}}}}if(hasJoin&&n.itemTrs[o].divSlider){var b=n.itemTrs[o].divSlider.getAttribute("defvalue");if(b&&isInt(b)){n.itemTrs[o].sliderImage.setValue(parseInt(b));}}}if(f==1){n.itemTrs[0].style.display=a?"":"none";}c.style.display=a?"none":"";n.displayContent=a;n.referDiv=k;break;case"radio":case"check":var g=n.itemInputs;for(var p=0;p<k.itemInputs.length;p++){var e=k.itemInputs[p];if(!e.value||e.type!="checkbox"){f++;continue;}var o=parseInt(e.value)-1+f;if(g[o]&&g[o].parentNode){g[o].parentNode.style.display=e.checked?"":"none";}if(e.checked){a=true;}}c.style.display=a?"none":"";n.displayContent=a;break;}}}var curMatrixItem=null;function divMatrixItemClick(){if(curMatrixItem==this){return;}if(curMatrixItem!=null){curMatrixItem.style.background=curMatrixItem.prevBackColor||"";if(curMatrixItem.daoZhi){itemInputs=curMatrixItem.itemInputs;for(var a=0;a<itemInputs.length;a++){itemInputs[a].parentNode.style.background="";}}}curMatrixItem=this;if(this.itemInputs){this.style.background="#edfafe";}}function divQuestionClick(){if(curdiv==this){return;}if(curdiv!=null){curdiv.style.background="";}if(curdiv&&curdiv.uploadFrame){curdiv.uploadFrame.style.backgroundColor="";}hasSaveChanged=true;showLeftBar();curdiv=this;if(this.uploadFrame){this.uploadFrame.style.backgroundColor="#edfafe";}if(curMatrixItem!=null&&curMatrixItem.parent!=curdiv){curMatrixItem.style.background=curMatrixItem.prevBackColor||"";}this.style.background="#edfafe";if(curMatrixItem!=null&&curMatrixItem.parent==curdiv){this.style.background="";}if(this.removeError){this.removeError();}if(!completeLoaded){this.style.background="";curdiv=null;}if(this.itemTextarea&&curdiv.parentNode&&curdiv.parentNode.style.display!="none"){this.itemTextarea.focus();}}function showLeftBar(){if(window.divLeftBar&&!hasDisplayed){if(divProgressImg){divProgressImg.style.visibility="visible";$("loadprogress").style.visibility="visible";}if(divSave){divSave.parentNode.style.visibility="visible";divSave.parentNode.style.marginTop="5px";}hasDisplayed=true;divLeftBar.style.background="#ffffff";}}var loadcss=null;var loadprogress=null;function updateProgressBar(b){var a=b._topic;if(a>MaxTopic){MaxTopic=a;}if(!progressArray[a]){joinedTopic++;progressArray[a]=true;showProgressBar(b);}}function showProgressBar(d){if(window.divProgressImg){if(!loadcss){loadcss=$("loadcss");}if(!loadprogress){loadprogress=$("loadprogress");}var c=totalQ;var e=joinedTopic;if(progressBarType==2){c=totalPage;e=cur_page+1;}var b=parseFloat(e)/c*100;b=b||0;if(b>=80&&d&&d._topic==totalQ){b=100;}var a=b+"%";loadcss.style.height=a;if(progressBarType==1){loadprogress.innerHTML="&nbsp;&nbsp;"+b.toFixed(0)+"%";}else{loadprogress.innerHTML="&nbsp;"+e+"/"+c+page_info;}if(hrefSave){if(spanSave){clearInterval(saveInterval);}}}}function checkMinMax(d,g,f){if(langVer==0&&(g._maxValue>0||g._minValue>0)){var k=f.itemInputs;var e=0;for(var b=0;b<k.length;b++){if(k[b].checked){e++;}}if(!f.divChecktip){f.divChecktip=document.createElement("div");f.appendChild(f.divChecktip);f.divChecktip.style.color="666";}var a="&nbsp;&nbsp;&nbsp;您已经选择了"+e+"项";if(g._maxValue>0&&e>g._maxValue){if(!g._referedTopics&&!g._hasjump&&!relationQs[g._topic]){alert("此题最多只能选择"+g._maxValue+"项");d.checked=false;e--;a="&nbsp;&nbsp;&nbsp;您已经选择了"+e+"项";var h=d.getAttribute("rel");if(g.isSort&&h&&$(h)){for(var c=0;c<$(h).options.length;c++){if($(h).options[c].value==d.value){$(h).options[c]=null;}}}}else{a+=",<span style='color:red;'>多选择了"+(e-g._maxValue)+"项</span>";}}else{if(g._minValue>0&&e<g._minValue){a+=",<span style='color:red;'>少选择了"+(g._minValue-e)+"项</span>";}}f.divChecktip.innerHTML=a;}}function itemSortClick(){var b=this.getAttribute("rel");if(b){var e=$(b);var c=e.selectedIndex;var a=e.options.length;if(this.name=="up"&&c>0){var d=e.options[c];var f=e.options[c-1];e.insertBefore(d,f);}else{if(this.name=="first"&&c>0){var d=e.options[c];var f=e.options[0];e.insertBefore(d,f);}else{if(this.name=="down"&&c>=0&&c<a-1){var d=e.options[c];var g=e.options[c+1];e.insertBefore(g,d);}else{if(this.name=="last"&&c>=0&&c<a-1){var d=e.options[c];var g=e.options[a-1];e.insertBefore(d,g);e.insertBefore(g,d);}}}}}}function itemClick(k){var e=this.parent.parent||this.parent;if(e.isTrap){return;}var m=e.dataNode;updateProgressBar(m);if(this.itemText&&this.itemText.onclick){if(this.checked){this.itemText.onclick();}else{if(this.itemText.onblur){this.itemText.onblur();}}}if(this.type=="checkbox"){checkHuChi(e,this);var n=this.getAttribute("rel");if(n){var c=$(n);var p=c.options;if(this.checked){var b=this.nextSibling.nodeValue||this.nextSibling.innerHTML;if(!b&&this.nextSibling.nextSibling){b=this.nextSibling.nextSibling.innerHTML;}var d=false;for(var a=0;a<p.length;a++){if(p[a].value==this.value){d=true;break;}}if(!d){c.options[p.length]=new Option(b,this.value);}}else{for(var a=0;a<p.length;a++){if(p[a].value==this.value){p[a]=null;}}}}if(m._referedTopics){createItem(e);}displayRelationRaidoCheck(e,m);checkMinMax(this,m,e);jump(e,this);if(m._type=="matrix"){k=k||window.event;if(k){if(k.stopPropagation){k.stopPropagation();}else{k.cancelBubble=true;}}}}else{if(this.type=="radio"||m._type=="slider"||(m._type=="matrix"&&m._mode!="201")){if(!m._requir&&!e.hasClearHref){addClearHref(e);}displayRelationRaidoCheck(e,m);jump(e,this);if(m._type=="matrix"&&(m._mode=="102"||m._mode=="103"||m._mode=="101")&&this.type=="text"){processTextR(this,e,m);}}else{if(m._type=="matrix"&&m._mode=="201"){var h=e.itemTrs;var f=0;var o;for(var a=0;a<h.length;a++){f=validateMatrix(m,h[a],h[a].itemInputs[0]);if(f&&!o){o=h[a].itemInputs[0];break;}}if(e.removeError){e.removeError();}if(o){e.errorControl=o;validate_ok=writeError(e,verifyMsg,3000);}var l=false;for(var a=0;a<h.length;a++){var g=h[a].itemInputs[0];if(trim(g.value)!=""){l=true;break;}}jumpAny(l,e);}else{if(m._type=="sum"){if(this.parent.sliderImage){sumClick(e,this.parent.sliderImage.sliderValue);}else{sumClick(e,this);}}else{if(this.type=="text"){processTextR(this,e,m);}else{if(this.nodeName=="SELECT"){e.focus();jump(e,this);displayRelationDropDown(e,m);}}}}}}}function processTextR(c,a,b){if(c.choiceRel){if(c.value==defaultOtherText){c.value="";}c.choiceRel.checked=true;c.style.color="#000000";c.style.background="";if(b._referedTopics){createItem(a);}if(c.choiceRel.type=="checkbox"){checkHuChi(a,c.choiceRel);checkMinMax(c.choiceRel,b,a);}displayRelationRaidoCheck(a,b);jump(a,c.choiceRel);}}function checkHuChi(c,f){if(!f.checked){return;}var e=c.dataNode;if(!e.hasHuChi){return;}var a=c.itemInputs;var d=e._select[f.value-1]._item_huchi;for(var b=0;b<a.length;b++){if(a[b].type!="checkbox"){continue;}if(a[b]==f){continue;}if(!a[b].checked){continue;}if(d){a[b].click();a[b].checked=false;}else{var g=e._select[a[b].value-1]._item_huchi;if(g){a[b].click();a[b].checked=false;}}}}function relationJoin(b){if(b.style.display!="none"){var c=b.dataNode;var a=c._type;if(a=="radio"||a=="check"){displayRelationRaidoCheck(b,c);}else{if(a=="radio_down"){displayRelationDropDown(b,c);}}}}function displayRelationRaidoCheck(h,k){var d=k._topic;if(!relationQs[d]){return;}h.hasDisplayByRelation=new Object();var i=-1;if(h.itemLis){var e=h.itemLis;for(var f=0;f<e.length;f++){if(e[f].className.indexOf("on")>-1){i=f+1;}}for(var f=0;f<e.length;f++){var c=false;var b=e[f].value;var g=d+","+b;if(i>-1&&b==i){c=true;}displayByRelation(h,g,c);}}else{var e=h.itemInputs;for(var f=0;f<e.length;f++){var c=false;var b=e[f].value;var g=d+","+b;if(e[f].checked){c=true;}displayByRelation(h,g,c);var a=d+",-"+b;if(relationHT[a]){displayByRelationNotSelect(h,a,c);}}}}function displayRelationDropDown(f,h){var c=h._topic;if(!relationQs[c]){return;}var i=f.itemSel;var g=f.itemSel.value;f.hasDisplayByRelation=new Object();for(var d=0;d<i.length;d++){var b=false;var a=i[d].value;var e=c+","+a;if(a==g){b=true;}displayByRelation(f,e,b);}}function displayByRelation(c,f,b){var d=relationHT[f];if(!d){return;}for(var a=0;a<d.length;a++){if(c.hasDisplayByRelation[d[a].dataNode._topic]){continue;}if(!b&&d[a].style.display!="none"){loopHideRelation(d[a]);}else{if(b){d[a].style.display="";var e=d[a].dataNode._topic;c.hasDisplayByRelation[e]="1";if(relationNotDisplayQ[e]){relationNotDisplayQ[e]="";}}}}}function displayByRelationNotSelect(c,f,b){var d=relationHT[f];if(!d){return;}for(var a=0;a<d.length;a++){if(c.hasDisplayByRelation[d[a].dataNode._topic]){continue;}if(b&&d[a].style.display!="none"){loopHideRelation(d[a]);}else{if(!b){d[a].style.display="";var e=d[a].dataNode._topic;c.hasDisplayByRelation[e]="1";if(relationNotDisplayQ[e]){relationNotDisplayQ[e]="";}}}}}function loopHideRelation(a){var c=a.dataNode._topic;var b=relationQs[c];if(b){for(var d=0;d<b.length;d++){loopHideRelation(b[d],false);}}clearAllOption(a);a.style.display="none";if(relationNotDisplayQ[c]==""){relationNotDisplayQ[c]="1";}}function sumClick(k,e,f){var r=k.getElementsByTagName("input");var s=k.dataNode;updateProgressBar(s);if(r){var h=r.length;var n=s._total;var c=n;var q=0;var m;var o;var b=e.value;if(parseInt(b)<0){e.value="";}for(var d=0;d<h;d++){var p=r[d].value;var l=k.itemTrs[d];if(l.style.display=="none"){p="";}var g=l.sliderImage;if(p&&trim(p)){if(isInt(p)){c=c-parseInt(p);if(g._value==undefined){g.setValue(parseInt(b),true);}else{if(f&&r[d]==e){g.setValue(parseInt(b),true);}}}else{r[d].value="";m=r[d];o=g;q++;}}else{if(l.style.display=="none"){}else{m=r[d];o=g;q++;}}}if(q==1&&c>=0){o.setValue(c,true);m.value=c;c=0;}k.sumLeft=c;var a="";if(q==0&&c!=0){a="<br/><span style='color:red;'>"+sum_warn+"</span>";}if(k.relSum){k.relSum.innerHTML=sum_total+"<b>"+n+"</b>"+sum_left+"<span style='color:red;font-bold:true;'>"+c+"</span>"+a;}jump(k,this);}}function jump(b,e){var c=b.dataNode;var a=c._anytimejumpto;var d=c._hasjump;if(d){if(a>0){jumpAnyChoice(b);}else{if(a==0&&c._type!="radio"&&c._type!="radio_down"){jumpAnyChoice(b);}else{jumpByChoice(b,e);}}}}function jumpAnyChoice(d,e){var a=d.itemInputs||d.itemLis||d.itemTrs||d.gapFills;var c=false;if(a){for(var b=0;b<a.length;b++){if(a[b].checked){c=true;}else{if(a[b].className.indexOf("on")>-1){c=true;}else{if(a[b].divSlider&&a[b].divSlider.value){c=true;}else{if(a[b].tagName=="TEXTAREA"&&trim(a[b].value)!=""){c=true;}else{if(a[b].type=="text"&&trim(a[b].value)!=""){c=true;}else{if(a[b].itemSels){for(var f=0;f<a[b].itemSels.length;f++){if(a[b].itemSels[f]){c=true;break;}}}}}}}}if(c){break;}}}else{if(d.itemSel){if(d.itemSel.selectedIndex>0){c=true;}else{c=false;}}else{if(d.divSlider){c=(d.divSlider.value!=undefined&&d.divSlider.value!=null)?true:false;}else{if(d.itemTextarea){c=trim(d.itemTextarea.value)!="";}else{if(d.uploadFrame){c=d.fileName?true:false;}}}}}jumpAny(c,d,e);}function jumpByChoice(b,d){var c=b.dataNode;if(d.value=="-2"){processJ(b.indexInPage-0,0,b.jumpInfo);}else{if(d.value=="-1"||d.value==""){processJ(b.indexInPage-0,0,b.jumpInfo);}else{if((c._type=="radio"||c._type=="radio_down")&&parseInt(d.value)==d.value){var a=c._select[d.value-1]._item_jump;processJ(b.indexInPage-0,a-0,b.jumpInfo);}}}}function txtChange(c,l){var e=c.parent.parent||c.parent;updateProgressBar(e.dataNode);hasSaveChanged=true;if(e.removeError){e.removeError();}if((e.dataNode._needOnly||(e.dataNode._hasList&&e.dataNode._listId!=-1))&&trim(c.value)!=""&&l){var a=getXmlHttp();a.onreadystatechange=function(){if(a.readyState==4){if(a.status==200){if(unescape(a.responseText)=="false1"){c.isOnly=false;writeError(e,validate_only,3000);}else{if(unescape(a.responseText)=="false2"){c.isInList=false;c.isOnly=true;writeError(e,validate_list,3000);}else{c.isInList=true;c.isOnly=true;}}}else{c.isOnly=true;c.isInList=true;}}};var n=e.dataNode._needOnly;var i=e.dataNode._hasList&&e.dataNode._listId!=-1;var d=e.dataNode._listId;a.open("get","/Handler/AnswerOnlyHandler.ashx?q="+activityId+"&at="+escape(c.value)+"&qI="+e.dataNode._topic+"&o="+n+"&l="+i+"&lid="+d+"&t="+(new Date()).valueOf());a.send(null);}var h=e.dataNode._verify;if(e.dataNode._type=="matrix"&&e.dataNode._mode=="303"){h="数字";}if(c.value!=""&&h&&h!="0"){if(e.removeError){e.removeError();}var k=e.dataNode;var m=e.getAttribute("issample");var g=true;if(m&&promoteSource!="t"){g=false;}if(g){var b=verifyMinMax(c,h,k._minword,k._maxword);if(b!=""){validate_ok=writeError(e,b,3000);}b=verifydata(c,h,e.dataNode);if(b!=""){validate_ok=writeError(e,b,3000);}}}if(e.dataNode._type=="gapfill"){var f=0;f=validateMatrix(e.dataNode,c,c);if(f){e.errorControl=c;writeError(e,verifyMsg,3000);}}if(e.dataNode._type=="sum"){sumClick(e,c,1);}else{jumpAny(trim(c.value)!="",e);}}function jumpAny(a,b,d){var c=b.dataNode;if(c._hasjump){if(a){processJ(b.indexInPage-0,c._anytimejumpto-0,b.jumpInfo,d);}else{processJ(b.indexInPage-0,0,b.jumpInfo,d);b.jumpInfo.innerHTML="<font color='#666666'>*"+jump_info+"</font>";}}}function processJ(m,c,k,d){var a=m+1;var b=cur_page;for(var g=cur_page;g<pageHolder.length;g++){var l=pageHolder[g].questions;if(c==1){b=g;}for(var f=a;f<l.length;f++){var h=l[f].dataNode._topic;if(h==c||c==1){b=g;}if(h<c||c==1){l[f].style.display="none";if(!progressArray[h]){joinedTopic++;progressArray[h]="jump";}}else{if(relationNotDisplayQ[h]){var e=1;}else{l[f].style.display="";}if(progressArray[h]=="jump"){joinedTopic--;progressArray[h]=false;}if(l[f].dataNode._hasjump&&!d){clearAllOption(l[f]);if(l[f].jumpInfo){l[f].jumpInfo.innerHTML="<font color='#0066ff'>*"+jump_info+"</font>";}}}}a=0;}k.innerHTML="";showProgressBar();}function addClearHref(b){var c=b.dataNode;var a=document.createElement("a");a.title=validate_info_submit_title2;a.className="link-999";a.style.marginLeft="25px";a.innerHTML="["+type_radio_clear+"]";a.href="javascript:void(0);";b.hasClearHref=true;b.divTitle.appendChild(a);b.clearHref=a;a.onclick=function(){clearAllOption(b);jumpAny(false,b);};}function clearAllOption(d){var e=d.itemSel;if(e){e.selectedIndex=0;}if(d.divSlider&&d.divSlider.value!=undefined){d.sliderImage.setValue(d.dataNode._minvalue,true);d.divSlider.value=undefined;}var a=d.itemInputs||d.itemLis||d.itemTrs;if(!a){return;}d.hasClearHref=false;if(d.clearHref){d.clearHref.parentNode.removeChild(d.clearHref);d.clearHref=null;}for(var c=0;c<a.length;c++){if(a[c].checked){a[c].checked=false;}else{if(a[c].className.toLowerCase().indexOf("on")>-1){a[c].className="off"+d.dataNode._mode;}else{if(a[c].parent&&a[c].parent.holder){a[c].parent.holder=0;}else{if(a[c].divSlider&&a[c].divSlider.value){a[c].sliderImage.setValue(d.dataNode._minvalue,true);a[c].divSlider.value=undefined;}else{var f=a[c].itemInputs||a[c].itemLis;if(f){for(var b=0;b<f.length;b++){if(f[b].checked){f[b].checked=false;}else{if(f[b].className.toLowerCase().indexOf("on")>-1){f[b].className="off"+d.dataNode._mode;}else{if(f[b].parent&&f[b].parent.holder){f[b].parent.holder=0;}}}}}}}}}}if(d.holder){d.holder=0;}}function itemMouseOver(){var c=this.parent.parent||this.parent;if(c.dataNode.isRate){var a=this.parent.itemLis.length;var d="on";for(var b=0;b<a;b++){d=b<this.value?"on":"off";this.parent.itemLis[b].className=d+c.dataNode._mode;}}}function itemMouseOut(){var d=this.parent.parent||this.parent;if(d.dataNode.isRate){var a=this.parent.itemLis.length;var e="on";var c=this.parent.holder||0;for(var b=0;b<a;b++){e=b<c?"on":"off";this.parent.itemLis[b].className=e+d.dataNode._mode;}}}function itemLiClick(){var b=this.parent.parent||this.parent;var c=b.dataNode;updateProgressBar(c);if(c.isRate){this.parent.holder=this.value;for(var a=0;a<this.value;a++){this.parent.itemLis[a].className="on"+c._mode;}if(!c._requir&&!b.hasClearHref){addClearHref(b);}displayRelationRaidoCheck(b,c);jump(b,this);}}function set_data_fromServer(d){var m=new Array();m=d.split("¤");var h=m[0];var a=h.split("§");hasTouPiao=a[0]=="true";useSelfTopic=a[1]=="true";var q=0;var n=0;var l=true;var p=0;for(var k=1;k<m.length;k++){var f=new Object();var e=m[k].split("§");switch(e[0]){case"page":if(l){l=false;}else{n++;}p=0;if(e[2]=="true"){pageHolder[n]._iszhenbie=true;}else{if(e[2]=="time"){pageHolder[n]._istimer=true;}}pageHolder[n]._mintime=e[3]?parseInt(e[3]):"";pageHolder[n]._maxtime=e[4]?parseInt(e[4]):"";break;case"question":f._type=trim(e[0]);f._topic=trim(e[1]);f._height=trim(e[2]);f._maxword=trim(e[3]);if(e[4]=="true"){f._requir=true;}else{f._requir=false;}if(e[5]=="true"){f._norepeat=true;}else{f._norepeat=false;}if(trim(e[6])=="true"){f._hasjump=true;}else{f._hasjump=false;}f._anytimejumpto=trim(e[7]);f._verify=trim(e[8]);f._needOnly=e[9]=="true"?true:false;f._hasList=e[10]=="true"?true:false;f._listId=e[11]?parseInt(e[11]):-1;f._minword=e[12];pageHolder[n].questions[p].dataNode=f;p++;break;case"slider":f._type=trim(e[0]);f._topic=trim(e[1]);if(e[2]=="true"){f._requir=true;}else{f._requir=false;}f._minvalue=trim(e[3]);f._maxvalue=trim(e[4]);if(trim(e[5])=="true"){f._hasjump=true;}else{f._hasjump=false;}f._anytimejumpto=trim(e[6]);pageHolder[n].questions[p].dataNode=f;p++;break;case"fileupload":f._type=trim(e[0]);f._topic=trim(e[1]);if(e[2]=="true"){f._requir=true;}else{f._requir=false;}f._maxsize=trim(e[3]);f._ext=trim(e[4]);if(trim(e[5])=="true"){f._hasjump=true;}else{f._hasjump=false;}f._anytimejumpto=trim(e[6]);pageHolder[n].questions[p].dataNode=f;p++;break;case"gapfill":f._type=trim(e[0]);f._topic=trim(e[1]);if(e[2]=="true"){f._requir=true;}else{f._requir=false;}f._gapcount=trim(e[3]);if(trim(e[4])=="true"){f._hasjump=true;}else{f._hasjump=false;}f._anytimejumpto=trim(e[5]);pageHolder[n].questions[p].dataNode=f;p++;break;case"sum":f._type=trim(e[0]);f._topic=trim(e[1]);if(e[2]=="true"){f._requir=true;}else{f._requir=false;}f._total=parseInt(e[3]);if(trim(e[4])=="true"){f._hasjump=true;}else{f._hasjump=false;}f._anytimejumpto=trim(e[5]);f._referTopic=e[6];pageHolder[n].questions[p].dataNode=f;p++;break;case"radio":case"check":case"radio_down":case"matrix":f._type=trim(e[0]);f._topic=trim(e[1]);f._numperrow=trim(e[2]);if(e[3]=="true"){f._hasvalue=true;}else{f._hasvalue=false;}if(e[4]=="true"){f._hasjump=true;}else{f._hasjump=false;}f._anytimejumpto=e[5];f._mode=trim(e[9]);if(e[0]!="check"){if(e[6]=="true"){f._requir=true;}else{f._requir=false;}f.isSort=false;f.isRate=isRadioRate(f._mode);}else{var o=e[6].split(",");f._minValue=0;f._maxValue=0;if(o[0]=="true"){f._requir=true;}else{f._requir=false;}if(o[1]!=""){f._minValue=Number(o[1]);}if(o[2]!=""){f._maxValue=Number(o[2]);}f.isSort=f._mode!=""&&f._mode!="0";f.isRate=false;}if(e[7]=="true"){f._isTouPiao=true;}else{f._isTouPiao=false;}f._verify=trim(e[8]);f._referTopic=e[10];f._referedTopics=e[11];var c=12;f._select=new Array();for(var g=c;g<e.length;g++){f._select[g-c]=new Object();var b=e[g].split("〒");if(b[0]=="true"){f._select[g-c]._item_radio=true;}else{f._select[g-c]._item_radio=false;}f._select[g-c]._item_value=trim(b[1]);f._select[g-c]._item_jump=trim(b[2]);f._select[g-c]._item_huchi=b[3]=="true";if(f._select[g-c]._item_huchi){f.hasHuChi=true;}}pageHolder[n].questions[p].dataNode=f;p++;break;default:break;}}}function show_pre_page(){if(cur_page>0&&pageHolder[cur_page-1].hasExceedTime){alert("上一页填写超时，不能返回上一页");return;}submit_table.style.display="none";next_page.style.display="";pageHolder[cur_page].style.display="none";cur_page--;for(var c=cur_page;c>=0;c--){if(pageHolder[c].skipPage){cur_page--;}else{break;}}for(var c=cur_page;c>=0;c--){if(pageHolder[c].questions.length==0){break;}var a=pageHolder[c].questions;var e=false;for(var b=0;b<a.length;b++){var d=a[b];if(d.style.display!="none"){e=true;break;}}if(!e&&cur_page>0){cur_page--;}else{break;}}if(cur_page==0&&pre_page){pre_page.style.display=displayPrevPage;pre_page.disabled=true;}if(window.divTouPiouId){$(divTouPiouId).style.display="none";}showDesc();pageHolder[cur_page].style.display="";var a=pageHolder[cur_page].questions;pageHolder[cur_page].scrollIntoView();adjustHeight();}function adjustHeight(){try{if(window.parent&&window.parent.adjustMyFrameHeight){window.parent.adjustMyFrameHeight();}}catch(a){}}var pubNoCheck=null;var saveNeedAlert=true;function checkDisalbed(){if(!submit_button.disabled){return false;}if(divMinTime.innerHTML){var a=divMinTime.innerHTML.replace(/<.+?>/gim,"");alert(a);}return true;}function show_next_page(a){if(next_page){next_page.disabled=true;}if(pubNoCheck!=true){if(isPreview){submit_button.onclick=function(){if(checkDisalbed()){return;}alert("此为预览状态，不能提交答卷！");};to_next_page();return;}else{if(a!=true&&!validate()){if(isPub&&pubNoCheck==null){if(window.confirm("您填写的数据不符合要求，由于您是发布者，可以选择直接跳到下一页（此次填写的答卷将不能提交），是否确定？")){pubNoCheck=true;$("submittest_button").onclick=submit_button.onclick=function(){if(checkDisalbed()){return;}alert("由于您选择了跳过了数据检查，所以此次填写的答卷无法提交！如果您需要提交答卷，请刷新此页面并再次填写问卷。");};to_next_page();return;}else{pubNoCheck=false;next_page.disabled=false;return;}}else{next_page.disabled=false;return;}}}}else{if(pubNoCheck==true){to_next_page();return;}}if(pageHolder[cur_page]._iszhenbie&&isRunning=="true"&&a!=true){submit(3);}else{to_next_page();if(a!=true&&allowSaveJoin&&isRunning=="true"&&guid){saveNeedAlert=false;submit(2);}}}function to_next_page(){if(cur_page==0&&nextPageAlertText){alert(nextPageAlertText);}pre_page.style.display=displayPrevPage;pre_page.disabled=false;pageHolder[cur_page].style.display="none";cur_page++;next_page.disabled=false;for(var c=cur_page;c<pageHolder.length;c++){if(pageHolder[c].skipPage){cur_page++;}else{break;}}for(var c=cur_page;c<pageHolder.length;c++){if(pageHolder[c].questions.length==0){break;}var a=pageHolder[c].questions;var f=false;for(var b=0;b<a.length;b++){var e=a[b];if(e.style.display!="none"){f=true;break;}}if(!f&&cur_page<pageHolder.length-1){cur_page++;}else{break;}}var d=true;for(var c=cur_page+1;c<pageHolder.length;c++){if(!pageHolder[c].skipPage){d=false;}}if(cur_page>=pageHolder.length-1||d){next_page.style.display="none";if(hasJoin!="1"){submit_table.style.display="";}if(window.divTouPiouId){$(divTouPiouId).style.display="";}}if(divMaxTime){divMaxTime.style.display="none";}showDesc();pageHolder[cur_page].style.display="";pageHolder[cur_page].scrollIntoView();showProgressBar();processMinMax();adjustHeight();}function showDesc(){if(!window.divDec){return;}var a=document.getElementById(window.divDec);if(a){a.style.display=cur_page>0?"none":"";}}if(hrefPreview){hrefPreview.onclick=function(){submit(0);return false;};}var spanSave=null;var saveInterval=null;var hasSaveChanged=false;var manualSave=false;var changeInterval=null;var totalSaveSec=1;if(hrefSave){hrefSave.onclick=function(){if(isRunning!="true"){alert("此问卷处于停止状态，不能保存！");return;}manualSave=true;submit(2);manualSave=false;return false;};if(isRunning=="true"){saveInterval=setInterval(function(){submit(2);},60000);}}var havereturn=false;var timeoutTimer=null;var errorTimes=0;var hasSendErrorMail=false;function processError(e,c,b,a){if(!havereturn){havereturn=true;var d="";var f=encodeURIComponent(e);if(f.length>1800){d=a+"&submitdata=exceed&partdata="+f.substring(0,1700);}else{d=a;if(a.indexOf("submitdata=")==-1){d+="&submitdata="+f;}if(a.indexOf("useget=")==-1){d+="&useget=1";}if(a.indexOf("iframe=")==-1){d+="&iframe=1";}}errorTimes++;if(errorTimes==1&&!hasSendErrorMail){d+="&nsd=1";hasSendErrorMail=true;}PDF_launch("/wjx/join/jqerror.aspx?"+d+"&status="+encodeURIComponent(c)+"&et="+errorTimes,400,120);refresh_validate();submit_tip.style.display="none";submit_div.style.display="block";}if(!window.submitWithGet){window.submitWithGet=1;}if(timeoutTimer){clearTimeout(timeoutTimer);}}function submit(n){if(n!=2&&!validate()){return;}if(tCode&&tCode.style.display!="none"&&n==1){var s=true;if(submit_text.value==""||submit_text.value==validate_info_submit_title3){alert(validate_info_submit1);s=false;}if(!s){try{submit_text.focus();submit_text.click();}catch(u){}return false;}}submit_tip.innerHTML=validate_info_submit2;if(n==0){PromoteUser("正在处理，请稍候...",3000,true);}else{if(n==2){if(!hasSaveChanged){if(manualSave){if(spanSave){spanSave.innerHTML="&nbsp;已保存";}else{PromoteUser("已保存",3000,true);}submit_tip.scrollIntoView();}return;}if(spanSave){spanSave.innerHTML="&nbsp;正在保存，请稍候...";}var x=cur_page;}else{if(n==3){PromoteUser("正在验证，请稍候...",3000,true);}else{submit_tip.style.display="block";submit_div.style.display="none";}}}needCheckLeave=false;var h=sent_to_answer();var y=getXmlHttp();y.onreadystatechange=function(){if(y.readyState==4){clearTimeout(timeoutTimer);var e=y.status;if(e==200){afterSubmit(y.responseText,n);}else{processError(h,e,n,m);}}};var m="submittype="+n+"&curID="+activityId+"&t="+(new Date()).valueOf();if(source){m+="&source="+encodeURIComponent(source);}if(window.udsid){m+="&udsid="+window.udsid;}if(window.cProvince){m+="&cp="+encodeURIComponent(cProvince.replace("'",""))+"&cc="+encodeURIComponent(cCity.replace("'",""))+"&ci="+escape(cIp);if(jiFen==0){var l=cProvince+","+cCity;try{setCookie("ip_"+cIp,l,null,"/","",null);}catch(v){}}}if(refu){m+="&refu="+encodeURIComponent(refu);}if(hasTouPiao){m+="&toupiao=t";}if(jiFen>0){m+="&jf="+jiFen;}if(randomparm){m+="&ranparm="+randomparm;}if(qinvited){m+="&qinvited="+qinvited;}if(inviteid){m+="&inviteid="+encodeURIComponent(inviteid);}if(SJBack){m+="&sjback=1";}if(eproguid){m+="&eproguid="+eproguid;}if(parterid){m+="&partnerid="+parterid;}if(window.cpid){m+="&cpid="+cpid;}if(n==2){m+="&lastpage="+x+"&lastq="+MaxTopic;}if(n==3){m+="&zbp="+(cur_page+1);}if(hasJoin){m+="&nfjoinid="+nfjoinid;}if(window.sojumpParm){m+="&sojumpparm="+encodeURIComponent(window.sojumpParm);}if(tCode&&tCode.style.display!="none"&&submit_text.value!=""){m+="&validate_text="+encodeURIComponent(submit_text.value);}m+="&starttime="+encodeURIComponent(starttime);if(guid){m+="&emailguid="+guid;}if(window.sjUser){m+="&sjUser="+encodeURIComponent(sjUser);}if(window.mobileRnum){m+="&m="+window.mobileRnum;}if(Password){m+="&psd="+encodeURIComponent(Password);}if(hasMaxtime){m+="&hmt=1";}if(sourceDetail){m+="&sd="+sourceDetail;}if(window.parterparm&&window.parterparmname){m+="&"+parterparmname+"="+parterparm;}if(wbid){m+="&wbid="+wbid;}if(imgVerify){m+="&btuserinput="+encodeURIComponent(submit_text.value);m+="&btcaptchaId="+encodeURIComponent(imgVerify.captchaId);m+="&btinstanceId="+encodeURIComponent(imgVerify.instanceId);}var w=window.alipayAccount||window.cAlipayAccount;if(w){m+="&alac="+encodeURIComponent(w);}h=h.replace(/\+/g,"%2B");var o=encodeURIComponent(h);var i=false;var f="";var r="";for(var k=0;k<trapHolder.length;k++){f="";var c=trapHolder[k].itemInputs;var t=new Array();for(var q=0;q<c.length;q++){if(c[q].checked){t.push(c[q].value);}}t.sort(function(z,e){return z-e;});for(var q=0;q<t.length;q++){f+=t[q]+",";}var p=trapHolder[k].getAttribute("trapanswer");if(f&&p&&f.indexOf(p)==-1){i=true;r=trapHolder[k].getAttribute("tikuindex");break;}}if(i){m+="&ite=1&ics="+encodeURIComponent(r+";"+f);}var g=false;var b="post";var d=window.getMaxWidth||1800;if(window.submitWithGet&&o.length<=d){g=true;}if(g){m+="&submitdata="+o;m+="&useget=1";b="get";}else{if(window.submitWithGet){window.postIframe=1;}}var a="/handler/processjq.ashx?"+m;y.open(b,a,false);y.setRequestHeader("Content-Type","application/x-www-form-urlencoded");havereturn=false;if(window.postIframe){postWithIframe(a,h,n);}else{if(g){if(errorTimes==2||window.getWithIframe){GetWithIframe(a,h,n,m);}else{if(n==1){timeoutTimer=setTimeout(function(){processError(h,"ajaxget",n,m);},20000);}y.send(null);}}else{if(n==1){timeoutTimer=setTimeout(function(){processError(h,"ajaxpost",n,m);},20000);}y.send("submitdata="+o);}}}function postWithIframe(d,e,b,a){if(b==1){timeoutTimer=setTimeout(function(){processError(e,"postiframe",b,a);},20000);}var c=document.createElement("div");c.style.display="none";c.innerHTML="<iframe id='mainframe' name='mainframe' style='display:none;' > </iframe><form target='mainframe' id='frameform' action='' method='post' enctype='application/x-www-form-urlencoded'><input  value='' id='submitdata' name='submitdata' type='hidden'><input type='submit' value='提交' ></form>";document.body.appendChild(c);$("submitdata").value=e;var f=$("frameform");f.action=d+"&iframe=1";f.submit();}function GetWithIframe(d,e,b,a){if(b==1){timeoutTimer=setTimeout(function(){processError(e,"getiframe",b,a);},20000);}var c=document.createElement("div");c.style.display="none";var g=d+"&iframe=1";c.innerHTML="<iframe id='mainframe' name='mainframe'> </iframe>";document.body.appendChild(c);var f=$("mainframe");f.src=g;}function getExpDate(d,a,c){var b=new Date();if(typeof(d)=="number"&&typeof(a)=="number"&&typeof(a)=="number"){b.setDate(b.getDate()+parseInt(d));b.setHours(b.getHours()+parseInt(a));b.setMinutes(b.getMinutes()+parseInt(c));return b.toGMTString();}}function processRedirect(d){var b=d[1];var a=d[3]||"";var h=d[2];if(!b||b[0]=="?"){b=window.location.href;}else{if(b.toLowerCase().indexOf("http://")==-1&&b.toLowerCase().indexOf("https://")==-1){b="http://"+b;}}if(window.sojumpParm){b=b.replace("{output}",sojumpParm);}if(window.sojumpParm){var c="sojumpindex="+a;if(b.indexOf("?")>-1){c="&"+c;}else{c="?"+c;}if(b.toLowerCase().indexOf("sojumpparm=")==-1){c+="&sojumpparm="+sojumpParm;}b+=c;}if(h&&h!="不提示"&&window.jiFenBao==0&&!window.sojumpParm){alert(h);}var f=window.location.host||"sojump.com";try{setCookie(activityId+"_save","",getExpDate(-1,0,0),"/",f,null);}catch(g){}location.replace(b);}var changeSave=false;function afterSubmit(v,l){havereturn=true;errorTimes=0;if($("PDF_bg_chezchenz")){PDF_close();}clearTimeout(timeoutTimer);var n=v.split("〒");var k=n[0];if(l==0){if(k==14){var b=n[1];var q="/wjx/previewanswer.aspx?activityid="+activityId+"&sg="+b+"&t="+(new Date()).valueOf();var a=$("hrefPQ");a.href=q;PDF_launch("divPreviewQ",300,100);}else{alert("请点击预览答卷按钮");}}else{if(l==2){if(k==14){var b=n[1];var h=window.location.href.toLowerCase();if(h.indexOf("?")>-1){if(h.indexOf("sg=")>-1){h=h.replace(/sg=([\w|\-]+)/g,"sg="+b);}else{h=h+"&sg="+b;}}else{h=h+"?sg="+b;}if(hrefSave){var r=getTop(hrefSave);if(!spanSave){spanSave=document.createElement("div");divSaveText.appendChild(spanSave);spanSave.style.color="#666666";spanSave.style.lineHeight="14px";spanSave.style.width="14px";if(divProgressImg){divProgressImg.style.paddingLeft="7px";}else{spanSave.style.paddingLeft="15px";}}var u=new Date();var o=u.getMinutes();if(o<10){o="0"+o;}var c=u.getHours();if(c<10){c="0"+c;}var d=c+":"+o;spanSave.innerHTML="答卷保存于<div id='saveData'>1</div><div id='divUnit'>秒</div>钟前";if(langVer==1){spanSave.innerHTML="<div style='font-size:18px;'>&nbsp;&nbsp;Saved</div>";}if(divLeftBar){divLeftBar.title="下次可以接着继续填写";}totalSaveSec=1;spanSave.style.display="";submit_tip.style.display="none";clearInterval(changeInterval);changeInterval=setInterval(function(){var e=$("saveData");if(e){totalSaveSec++;e.innerHTML=totalSaveSec;if(totalSaveSec>60){e.innerHTML=parseInt(totalSaveSec/60);$("divUnit").innerHTML="分";}}},1000);}hasSaveChanged=false;clearInterval(saveInterval);saveInterval=setInterval(function(){submit(2);},60000);if(!window.saveGuid){var m=window.location.host||"sojump.com";try{setCookie(activityId+"_save",b,getExpDate(30,0,0),"/",m,null);}catch(t){}}if(n[2]){nfjoinid=n[2];hasJoin="2";}if(n[3]){starttime=n[3];}if(changeSave){var h=window.location.href;if(h.indexOf("?")==-1){h+="?csave=1";}else{h+="&csave=1";}window.location=h;}return;}}else{if(l==3){if(k==12){randomparm=n[1];PromoteUser("",1,true);to_next_page();return;}else{if(k==13){var g=n[1];var w=n[2]||"0";var h="/wjx/join/complete.aspx?q="+activityId+"&s="+simple+"&joinid="+g;if(guid){h+="&guid="+guid;}if(promoteSource=="t"){h+="&ps="+promoteSource;}if(eproguid){h+="&eproguid="+eproguid;}h+="&v="+w;if(window.sjUser){h+="&sjUser="+encodeURIComponent(sjUser);}location.replace(h);return;}else{if(k==11){processRedirect(n);return;}else{if(k==5){alert(n[1]);return;}}}}}else{if(k==10){var h=n[1];h+="&s="+simple;if(promoteSource=="t"){h+="&ps="+promoteSource;}if(eproguid){h+="&eproguid="+eproguid;}if(qwidth){h+="&width="+qwidth;}if(qinvited){h+="&qinvited="+qinvited;}if(inviteid){h+="&inviteid="+inviteid;}if(parterid){h+="&partnerid="+parterid;}if(source){h+="&source="+encodeURIComponent(source);}if(guid){h+="&guid="+guid;}if(window.sjUser){h+="&sjUser="+encodeURIComponent(sjUser);}if(window.parterparm&&window.parterparmname){h+="&"+parterparmname+"="+parterparm;}if(window.needJQJiang){h+="&njqj=1";}if(window.HasJiFenBao){h+="&hjfb=1";}if(startAge){h+="&sa="+encodeURIComponent(startAge);}if(endAge){h+="&ea="+encodeURIComponent(endAge);}var m=window.location.host||"sojump.com";try{setCookie(activityId+"_save","",getExpDate(-1,0,0),"/",m,null);}catch(t){}location.replace(h);return;}else{if(k==11){processRedirect(n);return;}else{if(k==9||k==16){var p=parseInt(n[1]);var f=(p+1)+"";if(pageHolder.length==1&&pageHolder[0].questions[p]){writeError(pageHolder[0].questions[p],n[2],3000);pageHolder[0].questions[p].scrollIntoView();}else{if(questionsObject[f]){writeError(questionsObject[f],n[2],3000);alert(n[2]);questionsObject[f].scrollIntoView();}else{alert("您提交的数据有误，请检查！");}}}else{if(k==7){alert(n[1]);if(needAvoidCrack!=2){tCode.style.display="";submit_tip.style.display="none";submit_div.style.display="block";try{submit_text.focus();submit_text.click();if(imgVerify){imgVerify.onclick();}}catch(s){}}}else{if(k==2){alert(n[1]);window.submitWithGet=1;}else{if(k==17){alert("密码冲突！在您提交答卷之前，此密码已经被另外一个用户使用了，请重新更换密码！\r\n系统会自动保存您当前填写的答卷，请复制新的链接重新提交此份答卷！");submit(2);return;}else{if(k==4){alert(n[1]);changeSave=true;submit(2);return;}else{if(k==5){alert(n[1]);return;}else{if(k==19){alert(n[1]);window.location="/";return;}else{alert(n[1]);}}}}}}}}}}}}refresh_validate();submit_tip.style.display="none";submit_div.style.display="block";return;}var firstError=null;var firstMatrixError=null;var startAge=0;var endAge=0;function getAge(i,g){if(i._type!="radio"&&i._type!="radio_down"){return;}var e=g.divTitle.innerHTML;if(e.indexOf("年龄")==-1){return;}var a="";var f=0;if(i._type=="radio"&&g.itemInputs){for(var d=0;d<g.itemInputs.length;d++){if(g.itemInputs[d].checked){var h=g.itemInputs[d].nextSibling;if(h&&h.nodeType==3){h=h.nextSibling;}a=h.innerHTML;f=d;break;}}}else{if(i._type=="radio_down"){a=g.itemSel.options[g.itemSel.selectedIndex].text;f=g.itemSel.selectedIndex-1;}}if(!a){return;}var c=/[1-9][0-9]*/g;var b=a.match(c);if(!b||b.length==0){return;}if(b.length>2){return;}if(b.length==2){startAge=b[0];endAge=b[1];}else{if(b.length==1){if(f==0){startAge=b[0];}else{endAge=b[0];}}}}function sent_to_answer(){var p=new Array();var u=0;for(var q=0;q<pageHolder.length;q++){var V=pageHolder[q].questions;var o=pageHolder[q]._maxtime>0;for(var U=0;U<V.length;U++){var C=V[U].dataNode;var m=V[U].style.display.toLowerCase()=="none"||(V[U].dataNode._referTopic&&!V[U].displayContent)||pageHolder[q].skipPage;if(V[U].isCepingQ){m=false;}var n=new Object();n._topic=C._topic;n._value="";p[u++]=n;try{getAge(C,V[U]);}catch(L){}switch(C._type){case"question":if(m){n._value="(跳过)";continue;}var M=V[U].itemTextarea||V[U].itemInputs[0];var w=M.value||"";n._value=replace_specialChar(w);break;case"gapfill":var d=V[U].gapFills;for(var R=0;R<d.length;R++){if(R>0){n._value+=spChars[2];}if(m){n._value+="(跳过)";}else{n._value+=replace_specialChar(trim(d[R].value.substring(0,3000)));}}break;case"slider":var N=V[U].divSlider.value;if(m){n._value="(跳过)";continue;}n._value=N==undefined?"":N;break;case"fileupload":var A=V[U].fileName;if(m){n._value="(跳过)";continue;}n._value=A||"";break;case"sum":var r=V[U].itemInputs;len=r.length;for(var R=0;R<len;R++){var H=r[R];var I=V[U].relSum==0?trim(H.value)||"0":trim(H.value);if(V[U].itemTrs[R].style.display=="none"){I="";}if(R>0){n._value+=spChars[2]+I;}else{n._value=I;}}if(m){var O=0;while(O<len){if(O==0){n._value="(跳过)";}else{n._value+=spChars[2]+"(跳过)";}O++;}}break;case"radio":case"check":if(V[U].itemSel){var W=V[U].itemSel;var z=W.options;if(m){var O=0;while(O<C._select.length){if(O==0){n._value="-3";}else{n._value+=",-3";}O++;}continue;}for(var R=0;R<z.length;R++){if(R==0){n._value=z[R].value+"";}else{n._value+=","+z[R].value;}}if(z.length==0||z.length<C._select.length){var G=C._select.length;for(var R=z.length;R<G;R++){if(n._value){n._value+=",-2";}else{n._value="-2";}}}continue;}if(m){n._value="-3";continue;}var z=V[U].itemInputs||V[U].itemLis;var s=-1;var J=0;for(var R=0;R<z.length;R++){if(z[R].className.toLowerCase().indexOf("on")>-1){s=R;}var x=z[R].parentNode&&z[R].parentNode.style.display=="none";if(!x&&z[R].checked){J++;if(n._value){n._value+=spChars[3]+z[R].value;}else{n._value=z[R].value+"";}if(z[R].itemText){var S=z[R].itemText.value;if(S==defaultOtherText){S="";}n._value+=spChars[2]+replace_specialChar(trim(S.substring(0,3000)));}}}if(s>-1){n._value=z[s].value+"";}else{if(J>0){}else{n._value="-2";}}break;case"radio_down":if(m){n._value="-3";continue;}n._value=V[U].itemSel.value;break;case"matrix":var f=V[U].itemTrs;var h=C._mode;len=f.length;var X=0;var l=0;var F=0;var y=0;var P=new Array();var g=false;for(var R=0;R<f.length;R++){var b=f[R].getAttribute("rowIndex");if(b==0&&f[R].getAttribute("RandomRow")=="true"){g=true;}var Y=new Object();Y.rowIndex=b;if(f[R].style.display=="none"){if(h!="201"&&h!="202"&&h!="301"&&h!="302"&&h!="303"){if(n._value){n._value+=",-2";}else{n._value="-2";}Y.val="-2";continue;}}var z=f[R].itemInputs||f[R].itemLis||f[R].divSlider||f[R].itemSels;if(!z){len=len-1;y=1;continue;}else{X=z.length;}var s=-1;var E="";if(h!="201"&&h!="202"){for(var O=0;O<z.length;O++){if(z[O].className.toLowerCase().indexOf("on")>-1){s=O;E=z[O].value;}if(z[O].checked){s=O;if(E){E+=";"+z[O].value;}else{E=z[O].value;}if((h=="103"||h=="102"||h=="101")&&z[O].itemText){var T=trim(z[O].itemText.value);if(T==defaultOtherText){T="";}T=replace_specialChar(T).replace(/;/g,"；").replace(/,/g,"，");E+=spChars[2]+T;}}else{if(z[O].tagName=="TEXTAREA"||z[O].tagName=="SELECT"){s=O;var T=trim(z[O].value);if(f[R].style.display=="none"){T="";}if(O>0){E+=spChars[3];}if(T){if(h=="302"){T=replace_specialChar(T);}E+=T;}else{if(h=="303"){E+="-2";}else{E+="(空)";}}}}}if(s>-1){if(n._value){if(h=="301"||h=="302"||h=="303"){n._value+=spChars[2]+E;}else{n._value+=","+E;}}else{n._value=E;}Y.val=E;}else{if(n._value){n._value+=",-2";}else{n._value="-2";}Y.val="-2";}}else{if(h=="201"){var B=trim(z[0].value.substring(0,3000));if(f[R].style.display=="none"){B="";}if(F>0){n._value+=spChars[2]+replace_specialChar(B);}else{n._value=replace_specialChar(B);}Y.val=replace_specialChar(B);}else{if(h=="202"){var Q=f[R].divSlider.value==undefined?"":f[R].divSlider.value;if(f[R].style.display=="none"){Q="";}if(F>0){n._value+=spChars[2]+Q;}else{n._value=Q;}Y.val=Q;}}}P.push(Y);F++;}if(m){var O=0;n._value="";while(O<len){if(h=="201"||h=="202"){if(O==0){n._value="(跳过)";}else{n._value+=spChars[2]+"(跳过)";}}else{if(h=="301"||h=="302"||h=="303"){if(O>0){n._value+=spChars[2];}for(var D=0;D<X;D++){if(D>0){n._value+=spChars[3];}if(h=="303"){n._value+="-3";}else{n._value+="(跳过)";}}}else{if(O==0){n._value="-3";}else{n._value+=",-3";}}}O++;}continue;}else{if(g){P.sort(function(k,i){return k.rowIndex-i.rowIndex;});var c=spChars[2];if(h!="201"&&h!="202"&&h!="301"&&h!="302"&&h!="303"){c=",";}var K="";for(var a=0;a<P.length;a++){if(a>0){K+=c;}K+=P[a].val;}n._value=K;}}break;}}}p.sort(function(k,i){return k._topic-i._topic;});var e="";for(U=0;U<p.length;U++){if(U>0){e+=spChars[1];}e+=p[U]._topic;e+=spChars[0];e+=p[U]._value;}return e;}var verifyMsg="";function validate(){var y=true;var P=pageHolder[cur_page].questions;var A=pageHolder[cur_page].hasExceedTime;firstError=null;firstMatrixError=null;var R=document.getElementById("divNA");var G=R.getElementsByTagName("input");if(G[0].checked||G[1].checked){alert("系统检测到非法填写问卷");window.location.href=window.location.href;return;}for(var O=0;O<P.length;O++){var w=P[O].dataNode;var S=w._hasjump;verifyMsg="";var r=P[O].style.display.toLowerCase()=="none"||pageHolder[cur_page].skipPage;if(P[O].removeError){P[O].removeError();}if(r||(P[O].dataNode._referTopic&&!P[O].displayContent)||A){continue;}switch(w._type){case"question":var F=P[O].itemTextarea||P[O].itemInputs[0];var p=F.value||"";if(w._requir){if(trim(p)==""){y=writeError(P[O],validate_info+validate_info_wd1,3000);}}if(p.length-3000>0){y=writeError(P[O],"您输入的字数超过了3000，请修改！",3000);}var n=w._verify;var H=P[O].getAttribute("issample");var C=true;if(H&&promoteSource!="t"){C=false;}if(C){if(p){var E=verifyMinMax(F,n,w._minword,w._maxword);if(E!=""){y=writeError(P[O],E,3000);}}if(p!=""&&n&&n!="0"){var E=verifydata(F,n,w);if(E!=""){y=writeError(P[O],E,3000);}}}if(y&&trim(p)!=""&&isRunning=="true"){if(w._needOnly){if(F.isOnly==false){y=writeError(P[O],validate_only,3000);}else{if(F.isOnly!=true){y=writeError(P[O],validate_error,3000);F.focus();return y;}}}if(y&&w._hasList&&w._listId!=-1){if(F.isInList==false){y=writeError(P[O],validate_list,3000);}else{if(F.isInList!=true){y=writeError(P[O],validate_error,3000);F.focus();return y;}}}}if(S){jumpAnyChoice(P[O],true);}break;case"gapfill":var c=P[O].gapFills;for(var M=0;M<c.length;M++){var p=c[M].value||"";if(trim(p)==""){if(w._requir){P[O].errorControl=c[M];y=writeError(P[O],validate_info+validate_info_wd1,3000);break;}}else{var L=0;L=validateMatrix(w,c[M],c[M]);if(L){P[O].errorControl=c[M];y=writeError(P[O],verifyMsg,3000);break;}}}break;case"slider":var I=P[O].divSlider.value;if(w._requir&&I==undefined){y=writeError(P[O],validate_info+validate_info_wd1,3000);}if(S){jumpAnyChoice(P[O],true);}break;case"fileupload":if(w._requir&&!P[O].fileName){y=writeError(P[O],validate_info+validate_info_wd1,3000);}if(S){jumpAnyChoice(P[O],true);}break;case"sum":var J=P[O].sumLeft;if(J==0){var m=P[O].getElementsByTagName("input");J=P[O].dataNode._total;for(var x=0;x<m.length;x++){var v=m[x];var T=P[O].itemTrs[x];if(T.style.display!="none"){J=J-parseInt(v.value);}}}if(w._requir){if(J!=0){y=false;if(!firstError){firstError=P[O];}var E="<br/><span style='color:red;'>"+sum_warn+"</span>";if(P[O].relSum){P[O].relSum.innerHTML=sum_total+"<b>"+w._total+"</b>"+sum_left+"<span style='color:red;font-bold:true;'>"+(J||w._total)+"</span>"+E;}}}else{if(J!=undefined&&J!=0){y=false;if(!firstError){firstError=P[O];}var E="<br/><span style='color:red;'>"+sum_warn+"</span>";if(P[O].relSum){P[O].relSum.innerHTML=sum_total+"<b>"+w._total+"</b>"+sum_left+"<span style='color:red;font-bold:true;'>"+(J||w._total)+"</span>"+E;}}}if(S){jumpAnyChoice(P[O],true);}break;case"radio":case"check":if(P[O].itemSel){var Q=P[O].itemSel;var s=Q.options;if(s.length==0&&w._requir){y=writeError(P[O],validate_info+validate_info_wd1,3000);}else{if(s.length>0){if((w._minValue==0||w._minValue==w._select.length)&&s.length!=w._select.length){y=writeError(P[O],validate_info+validate_info_check3,3000);}else{if(w._maxValue>0&&s.length>w._maxValue){var B=validate_info+validate_info_check1+w._maxValue+validate_info_check2;if(langVer==0){B+=",您多选择了"+(s.length-w._maxValue)+"项";}y=writeError(P[O],B,3000);}else{if(w._minValue>0&&s.length<w._minValue){var B=validate_info+validate_info_check1+w._minValue+validate_info_check2;if(langVer==0){B+=",您少选择了"+(w._minValue-s.length)+"项";}y=writeError(P[O],B,3000);}}}}}if(S){jumpAnyChoice(P[O],true);}continue;}var s=P[O].itemInputs||P[O].itemLis;var o=-1;var D=0;var f=-1;for(var M=0;M<s.length;M++){if(s[M].className.toLowerCase().indexOf("on")>-1){o=M;f=M;}if(s[M].checked){D++;f=M;if(s[M].req&&isTextBoxEmpty(s[M].itemText.value)){y=writeError(P[O],validate_textbox,3000);}}}if(o>-1){hasChoice=true;}else{if(D>0){hasChoice=true;if(w._maxValue>0&&D>w._maxValue){var B=validate_info+validate_info_check4+w._maxValue+type_check_limit5;if(langVer==0){B+=",您多选择了"+(D-w._maxValue)+"项";}y=writeError(P[O],B,3000);}else{if(w._minValue>0&&D<w._minValue){var B=validate_info+validate_info_check5+w._minValue+type_check_limit5;if(langVer==0){B+=",您少选择了"+(w._minValue-D)+"项";}y=writeError(P[O],B,3000);}}}else{if(w._requir){y=writeError(P[O],validate_info+validate_info_wd1,3000);}}}if(S){if(w._type=="radio"&&w._anytimejumpto<1){if(f>-1){processJ(P[O].indexInPage-0,w._select[s[f].value-1]._item_jump-0,P[O].jumpInfo,true);}else{processJ(P[O].indexInPage-0,0,P[O].jumpInfo,true);}}else{jumpAnyChoice(P[O],true);}}break;case"radio_down":if(w._requir&&P[O].itemSel.selectedIndex==0){y=writeError(P[O],validate_info+validate_info_wd1,3000);}if(S){if(w._anytimejumpto<1){if(P[O].itemSel.selectedIndex==0){processJ(P[O].indexInPage-0,0,P[O].jumpInfo,true);}else{processJ(P[O].indexInPage-0,w._select[P[O].itemSel.value-1]._item_jump-0,P[O].jumpInfo,true);}}else{jumpAnyChoice(P[O],true);}}break;case"matrix":var e=P[O].itemTrs;var g=w._mode;len=e.length;var h=0;var d=0;var L=0;var u;for(var M=0;M<e.length;M++){if(e[M].style.display=="none"){len=len-1;continue;}var s=e[M].itemInputs||e[M].itemLis||e[M].divSlider||e[M].itemSels;if(!s){len=len-1;continue;}var o=-1;var D=0;if(g!="201"&&g!="202"){for(var K=0;K<s.length;K++){if(s[K].className.toLowerCase().indexOf("on")>-1){o=K;}else{if(s[K].checked){o=K;D++;if((g=="103"||g=="102"||g=="101")&&s[K].itemText&&s[K].req){var b=s[K].itemText.value;if(isTextBoxEmpty(b)){if(!u){u=s[K].itemText;}verifyMsg=validate_textbox;L=1;if(!firstMatrixError){firstMatrixError=P[O].itemTrs[M];}}}}else{if(s[K].tagName=="TEXTAREA"||s[K].tagName=="SELECT"){var N=trim(s[K].value);o=K;if(!N){if(g=="303"){if(s[K].parentNode.style.display!="none"){o=-1;break;}}else{o=-1;if(g=="301"&&w._requir){d=1;if(!u){u=s[K];}if(!firstMatrixError){firstMatrixError=P[O].itemTrs[M];}}break;}}else{if(g=="301"){N=DBC2SBC(s[K]);if(!/^(\-)?\d+(\.\d+)?$/.exec(N)){d=1;}else{if((w._minvalue&&parseInt(N)-parseInt(w._minvalue)<0)||(w._maxvalue&&parseInt(N)-parseInt(w._maxvalue)>0)){d=2;}}if(d){if(!u){u=s[K];}if(!firstMatrixError){firstMatrixError=P[O].itemTrs[M];}}}}}}}}if(g=="102"){if(o>-1){var a=false;if(w._maxvalue>0&&D>w._maxvalue){var B=validate_info+validate_info_check4+w._maxvalue+type_check_limit5;if(langVer==0){B+=",您多选择了"+(D-w._maxvalue)+"项";}verifyMsg=B;L=1;if(!firstMatrixError){firstMatrixError=P[O].itemTrs[M];}}else{if(w._minvalue>0&&D<w._minvalue){var B=validate_info+validate_info_check5+w._minvalue+type_check_limit5;if(langVer==0){B+=",您少选择了"+(w._minvalue-D)+"项";}verifyMsg=B;L=1;if(!firstMatrixError){firstMatrixError=P[O].itemTrs[M];}}}}}}else{if(g=="201"){if(!L){L=validateMatrix(w,e[M],s[0]);}if(L){if(!u){u=s[0];}if(!firstMatrixError){firstMatrixError=P[O].itemTrs[M];}}if(trim(s[0].value)!=""){o=0;}}else{if(g=="202"){if(e[M].divSlider.value!=undefined){o=0;}}}}if(o>-1){h++;}else{if(w._requir){break;}}}if(w._requir&&h<len){y=writeError(P[O],validate_info+validate_info_matrix2+validate_info_matrix1+(h+1)+validate_info_matrix3,3000);if(P[O].itemTrs[M]&&!firstMatrixError){firstMatrixError=P[O].itemTrs[M];P[O].itemTrs[M].onclick();}}if(g=="201"&&L){if(u){P[O].errorControl=u;}y=writeError(P[O],verifyMsg,3000);if(firstMatrixError){firstMatrixError.onclick();}}if((g=="102"||g=="103"||g=="101")&&L){if(u){P[O].errorControl=u;}y=writeError(P[O],verifyMsg,3000);if(firstMatrixError){firstMatrixError.onclick();}}if(g=="301"&&d){var q="";if(d==2){if(w._minvalue){q+=","+type_wd_minlimitDigit+":"+w._minvalue;}if(w._maxvalue){q+=","+type_wd_maxlimitDigit+":"+w._maxvalue;}}if(u){P[O].errorControl=u;}y=writeError(P[O],validate_info+validate_info_matrix4+q,3000);if(firstMatrixError){firstMatrixError.onclick();}}if(S){jumpAnyChoice(P[O],true);}break;}}for(var z=0;z<trapHolder.length;z++){if(trapHolder[z].pageIndex!=cur_page+1){continue;}var s=trapHolder[z].itemInputs;var l="";for(var M=0;M<s.length;M++){if(s[M].checked){l+=s[M].value+",";}}if(!l){y=writeError(trapHolder[z],validate_info+validate_info_wd1,3000);break;}}if(firstError){PromoteUser(validate_submit,3000,false);if(firstMatrixError&&firstMatrixError.parent==firstError){firstMatrixError.scrollIntoView();}else{firstError.scrollIntoView();}}return y;}function validateMatrix(i,b,f){var d=0;if(!f.value){return d;}var h=f.value;var a=b.getAttribute("itemverify")||"";var g=b.getAttribute("minword")||"";var c=b.getAttribute("maxword")||"";var k=b.getAttribute("issample");var e=true;verifyMsg="";if(k&&promoteSource!="t"){e=false;}if(e){verifyMsg=verifyMinMax(f,a,g,c);}if(verifyMsg!=""){d=1;}if(e&&d==0&&a&&a!="0"){verifyMsg=verifydata(f,a,i);if(verifyMsg!=""){d=2;}}return d;}function removeError(){if(this.errorMessage){try{this.removeChild(this.errorMessage);this.errorMessage=null;}catch(a){this.errorMessage.innerHTML="";}this.removeError=null;this.style.border="solid 2px white";this.style.borderBottom="solid 1px #efefef";this.style.paddingBottom="5px";if(this.errorControl){this.errorControl.style.background="white";this.errorControl=null;}}}function PromoteUser(c,b,a){show_status_tip(c,b);if(!a){alert(c);}}function writeError(b,d,c){if(b.errorMessage&&b.errorMessage.innerHTML!=""){return;}if(b.dataNode&&((b.dataNode._type=="matrix"&&b.dataNode._mode=="202")||b.dataNode._type=="slider")){}else{b.style.padding="4px";b.style.border="solid 2px #ff9900";b.style.borderBottom="solid 2px #ff9900";}if(b.errorMessage&&b.errorMessage.innerHTML==""){b.errorMessage.innerHTML=d;}else{var a=document.createElement("div");a.className="errorMessage";a.setAttribute("for",b.id);a.setAttribute("htmlFor",b.id);a.appendChild(document.createTextNode(d));b.appendChild(a);b.errorMessage=a;}b.removeError=removeError;if(b.errorControl){b.errorControl.style.background="#ff3300";}if(!firstError){firstError=b;}return false;}function show_status_tip(a,b){submit_tip.style.display="block";submit_tip.innerHTML=a;if(b>0){setTimeout("submit_tip.style.display='none'",b);}}function isDate(c){var a=new Array();if(c.indexOf("-")!=-1){a=c.toString().split("-");}else{if(c.indexOf("/")!=-1){a=c.toString().split("/");}else{return false;}}if(a[0].length==4){var b=new Date(a[0],a[1]-1,a[2]);if(b.getFullYear()==a[0]&&b.getMonth()==a[1]-1&&b.getDate()==a[2]){return true;}}return false;}function DBC2SBC(b){var e=b.value;var a;if(e.length<=0){return false;}qstr1="１２３４５６７８９０－";bstr1="1234567890-";var d=false;for(a=0;a<e.length;a++){var f=e.charAt(a);if(qstr1.indexOf(f)!=-1){e=e.replace(f,bstr1.charAt(qstr1.indexOf(f)));d=true;}}if(d){b.value=e;}return b.value;}function verifydata(f,d,e){var c=f.value;var a=null;if(d.toLowerCase()=="email"||d.toLowerCase()=="msn"){a=/^\w+([-+.]\w+)*@\w+([-.]\\w+)*\.\w+([-.]\w+)*$/;if(!a.exec(c)){return validate_email;}else{return"";}}else{if(d=="日期"||d=="生日"||d=="入学时间"){if(!isDate(c)){return validate_date;}else{return"";}}else{if(d=="固话"){c=DBC2SBC(f);a=/^((\d{4}-\d{7})|(\d{3,4}-\d{8}))(-\d{1,4})?$/;if(!a.exec(c)){return validate_phone;}else{return"";}}else{if(d=="手机"){c=DBC2SBC(f);a=/^\d{11}$/;if(!a.exec(c)){return validate_mobile;}else{return"";}}else{if(d=="电话"){a=/(^\d{11}$)|(^((\d{4}-\d{7})|(\d{3,4}-\d{8}))(-\d{1,4})?$)/;if(!a.exec(c)){return validate_mo_phone;}else{return"";}}else{if(d=="汉字"){a=/^[\u4e00-\u9fa5]+$/;if(!a.exec(c)){return validate_chinese;}else{return"";}}else{if(d=="英文"){a=/^[A-Za-z]+$/;if(!a.exec(c)){return validate_english;}else{return"";}}else{if(d=="网址"||d=="公司网址"){a=/^http:\/\/[A-Za-z0-9]+\.[A-Za-z0-9]+[\/=\?%\-&_~`@[\]\':+!]*([^<>\"\"])*$/;if(!a.exec(c)){return validate_reticulation;}else{return"";}}else{if(d=="身份证号"){c=DBC2SBC(f);a=/^\d{15}(\d{2}[A-Za-z0-9])?$/;if(!a.exec(c)){return validate_idcardNum;}else{return"";}}else{if(d=="数字"){c=DBC2SBC(f);a=/^(\-)?\d+$/;if(!a.exec(c)){return validate_num;}}else{if(d=="小数"){c=DBC2SBC(f);a=/^(\-)?\d+(\.\d+)?$/;if(!a.exec(c)){return validate_decnum;}}else{if(d.toLowerCase()=="qq"){c=DBC2SBC(f);a=/^\d+$/;var b=/^\w+([-+.]\w+)*@\w+([-.]\\w+)*\.\w+([-.]\w+)*$/;if(!a.exec(c)&&!b.exec(c)){return validate_qq;}else{return"";}}}}}}}}}}}}}return"";}function verifyMinMax(f,e,c,a){var d=f.value;if(e=="数字"||e=="小数"){if(!afterDigitPublish){return"";}d=DBC2SBC(f);var b=/^(\-)?\d+$/;if(e=="小数"){b=/^(\-)?\d+(\.\d+)?$/;}if(!b.exec(d)){if(e=="小数"){return validate_decnum;}else{return validate_num;}}if(c!=""&&parseInt(d)-parseInt(c)<0){return validate_num2+c;}if(a!=""&&parseInt(d)-parseInt(a)>0){return validate_num1+a;}}else{if(a!=""&&d.length-a>0){return validate_info_wd3.format(a,d.length);}if(c!=""&&d.length-c<0){return validate_info_wd4.format(c,d.length);}}return"";}function getXmlHttp(){var a;try{a=new ActiveXObject("Msxml2.XMLHTTP");}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP");}catch(b){try{a=new XMLHttpRequest();}catch(b){}}}return a;}if(hasQJump&&window.jqLoaded){jqLoaded();}if(totalPage>1&&window.divTouPiouId){$(divTouPiouId).style.display="none";}if(nv==1){var ii=cur_page;for(;ii<totalPage;ii++){if(validate()){to_next_page();}else{break;}}}if(self.location!=top.location){var divpoweredby=document.getElementById("divpoweredby");if(divpoweredby){divpoweredby.style.display="block";}}